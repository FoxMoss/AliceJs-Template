(()=>{var g=[],E=Symbol(),x=Symbol(),b=Symbol();Object.defineProperty(window,"use",{get:()=>(g=[],(i,n)=>{let o=g;return g=[],o[x]=!0,n&&(o[E]=n),o})});Object.assign(window,{stateful:k,handle:h,useValue:v,css:_,styled:{new:_}});function k(i){return i[b]=[],new Proxy(i,{get(o,t,l){return g.push({target:o,property:t,proxy:l}),Reflect.get(o,t,l)},set(o,t,l){for(let f of o[b])f(o,t,l);return Reflect.set(o,t,l)}})}function p(i){return i instanceof Array&&x in i}function h(i,n){if(!p(i))throw new Error("Not an AliceJS reference set!");if(E in i){let o=i[E],t=[],l=[],f=new Map,e=[],s=(u,c,d)=>{t.includes(c)&&l.includes(u)&&(f.get(u)[c]=d)},r=()=>{let u=e.map(d=>f.get(d[0])[d[1]]),c=o(...u.reverse());n(c)};for(let u of i){let c=u.target,d=u.property;t.push(d),l.push(c),e.push([c,d]),f.has(c)||f.set(c,{}),s(c,d,c[d]),c[b].push((a,y,O)=>{s(a,y,O),r()})}r()}else{let o=i[i.length-1],t=(l,f,e)=>{f===o.property&&l===o.target&&n(e)};o.target[b].push(t),t(o.target,o.property,o.target[o.property])}}function v(i){let n=i[i.length-1];return n.proxy[n.property]}Object.defineProperty(window,"h",{get:()=>(g=[],(i,n,...o)=>{let t=g;return t[x]=!0,t.length==1&&o.length==1?(g=[],m(i,n,t)):m(i,n,...o)})});function m(i,n,...o){if(typeof i=="function"){let e=k({});for(let s in n){let r=n[s];if(p(r)&&s.startsWith("bind:")){let u=r[r.length-1],c=s.substring(5);if(c=="this")u.proxy[u.property]=e;else{let d=!1;h(r,a=>{if(d){d=!1;return}d=!0,e[c]=a}),h(use(e[c]),a=>{if(d){d=!1;return}d=!0,u.proxy[u.property]=a})}delete n[s]}}return i.apply(e,[n])}let t=document.createElement(i);function l(e){if(p(e)){let s=[];h(e,r=>{s.length>1?(s.forEach(u=>u.remove()),s=l(r)):s.length>0?s[0].replaceWith((s=l(r))[0]):s=l(r)})}else{if(e instanceof Node)return t.appendChild(e),[e];if(e instanceof Array){let s=[];for(let r of e)s=s.concat(l(r));return s}else{let s=document.createTextNode(e);return t.appendChild(s),[s]}}}for(let e of o)l(e);if(!n)return t;function f(e,s){if(!(e in n))return;let r=n[e];s(r),delete n[e]}if(f("before",e=>{l(e())}),f("if",e=>{let s=n.then,r=n.else;if(p(e))s&&t.appendChild(s),r&&t.appendChild(r),h(e,u=>{s?u?(s.style.display="",r&&(r.style.display="none")):(s.style.display="none",r&&(r.style.display="")):u?t.style.display="":t.style.display="none"});else if(s)e?t.appendChild(s):r&&t.appendChild(r);else if(e)t.appendChild(s);else if(r)t.appendChild(r);else return t.style.display="none",document.createTextNode("");delete n.then,delete n.else}),"for"in n&&"do"in n){let e=n.for,s=n.do;if(p(e)){let r=[],u=[];h(e,c=>{if(Object.keys(c).length&&Object.keys(c).length==u.length){let d=0;for(let a in c){if(A(c[a],u[a]))continue;let y=s(c[a],a,c);t.replaceChild(y,r[d]),r[d]=y,d+=1}u=Object.keys(JSON.parse(JSON.stringify(c)))}else{for(let d of r)d.remove();for(let d in c){let a=c[d],y=s(a,d,c);y instanceof HTMLElement&&(r.push(y),t.appendChild(y))}u=[]}})}else for(let r in e){let u=e[r],c=s(u,r,e);c instanceof Node&&t.appendChild(c)}delete n.for,delete n.do}f("after",e=>{l(e())});for(let e in n){let s=n[e];if(p(s)&&e.startsWith("bind:")){let r=s[s.length-1],u=e.substring(5);u=="this"?r.proxy[r.property]=t:u=="value"?(h(s,c=>t.value=c),t.addEventListener("change",()=>{r.proxy[r.property]=t.value})):u=="checked"&&(h(s,c=>t.checked=c),t.addEventListener("click",()=>{r.proxy[r.property]=t.checked})),delete n[e]}}for(let e in n){let s=n[e];p(s)?h(s,r=>{C(t,e,r)}):C(t,e,s)}return f("css",e=>{t.classList.add(e),t.classList.add("self")}),t}function C(i,n,o){if(n==="class"){i.className=o;return}if(typeof o=="function"&&n==="mount"){o(i);return}if(typeof o=="function"&&n.startsWith("on:")){let t=n.substring(3);for(let l of t.split("$"))i.addEventListener(l,(...f)=>{window.$el=i,o(...f)});return}if(typeof o=="function"&&n.startsWith("observe")){let t=window[`${n.substring(8)}Observer`];if(!t){console.error(`Observer ${n} does not exist`);return}new t(f=>{for(let e of f)window.$el=i,o(e)}).observe(i);return}i.setAttribute(n,o)}function S(i,n){let o="",t=document.implementation.createHTMLDocument(""),l=document.createElement("style");l.textContent=n,t.body.appendChild(l);for(let f of l.sheet.cssRules)f.selectorText=f.selectorText.includes("self")?`.${i}.self${f.selectorText.replace("self","")}`:`.${i} ${f.selectorText}`,o+=`${f.cssText}
`;return o}function _(i,...n){let o=`alicecss-${Array(16).fill(0).map(()=>Math.floor(Math.random()*16).toString(16)).join("")}`,t=document.createElement("style");document.head.appendChild(t);let l=[];for(let f in i)if(l.push(i[f]),n[f]){let e=n[f];if(p(e)){let s=l.length;h(e,r=>{l[s]=String(r),t.textContent=S(o,l.join(""))})}else l.push(String(e))}return t.textContent=S(o,l.join("")),o}function A(i,n){let o=Object.keys(i),t=Object.keys(n);if(o.length!==t.length)return!1;for(let l of o){let f=i[l],e=n[l],s=w(f)&&w(e);if(s&&!A(f,e)||!s&&f!==e)return!1}return!0}function w(i){return i!=null&&typeof i=="object"}})();
